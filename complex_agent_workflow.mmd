graph TD
    %% Styling
    classDef mainNode fill:#0f172a,stroke:#3b82f6,stroke-width:2px,color:#fff,rx:5,ry:5,shadow:10px
    classDef agent fill:#1e293b,stroke:#64748b,stroke-width:1px,color:#e2e8f0,rx:5,ry:5
    classDef tool fill:#047857,stroke:#10b981,stroke-width:1px,color:#fff,stroke-dasharray: 5 5,rx:10,ry:10
    classDef decision fill:#7c2d12,stroke:#f97316,stroke-width:2px,color:#fff,rhombus
    classDef storage fill:#4338ca,stroke:#6366f1,stroke-width:2px,color:#fff,cyl

    %% Start
    Start([ðŸš€ User Request]):::mainNode --> Router{âš¡ Triage?}:::decision

    %% Router Logic
    Router -- "Research" --> ResearchQueue[ðŸ“¥ Research Queue]:::agent
    Router -- "Development" --> DevQueue[ðŸ“¥ Dev Queue]:::agent
    Router -- "Analysis" --> DataQueue[ðŸ“¥ Data Queue]:::agent

    %% Research Subsystem
    subgraph Research_Squad [ðŸ” Autonomous Research Squad]
        direction TB
        ResearchQueue --> LeadResearcher[ðŸ‘¨â€ðŸ”¬ Lead Researcher]:::agent
        LeadResearcher --> Planner[ðŸ“ Plan Generator]:::agent
        Planner --> ParallelExec{âš™ï¸ Parallel Execution}:::decision
        
        ParallelExec --> WebScraper[ðŸ•¸ï¸ Web Scraper]:::tool
        ParallelExec --> PaperSearch[ðŸ“„ ArXiv/Paper Search]:::tool
        ParallelExec --> CompetitorAnalyst[ðŸ“Š Market Analysis]:::tool
        
        WebScraper --> RawData[(ðŸ—„ï¸ Raw Data Lake)]:::storage
        PaperSearch --> RawData
        CompetitorAnalyst --> RawData
        
        RawData --> Synthesizer[ðŸ§  Insight Synthesizer]:::agent
        Synthesizer --> DraftReport[ðŸ“„ Draft Report]:::agent
        DraftReport --> FactCheck[âœ… Fact Checker]:::agent
        FactCheck -- "Errors Found" --> Planner
    end

    %% Development Subsystem
    subgraph Dev_Squad [ðŸ’» Engineering Division]
        direction TB
        DevQueue --> Architect[ðŸ—ï¸ System Architect]:::agent
        Architect --> SpecDoc[ðŸ“ Technical Spec]:::agent
        SpecDoc --> CodeGenerator[ðŸ¤– Code Generator]:::agent
        
        CodeGenerator -- "Uses" --> DocsTool[ðŸ“š Documentation RAG]:::tool
        CodeGenerator --> CodeReviewer[ðŸ§ Code Reviewer]:::agent
        
        CodeReviewer -- "Needs Improvement" --> CodeGenerator
        CodeReviewer -- "Approved" --> TestSuite[ðŸ§ª Automated Testing]:::tool
        
        TestSuite -- "Failed" --> Debugger[ðŸž Auto-Debugger]:::agent
        Debugger --> CodeGenerator
    end
    
    %% Deployment Subsystem
    subgraph Ops_Squad [ðŸš€ DevOps & Deployment]
        TestSuite -- "Passed" --> SecScan[ðŸ›¡ï¸ Security Scanner]:::tool
        SecScan --> CI_CD[ðŸ”„ CI/CD Pipeline]:::agent
        CI_CD --> Staging[ðŸŒ Staging Environment]:::agent
        Staging --> UserAcceptance{ðŸ‘ User Approval?}:::decision
        UserAcceptance -- "No" --> Architect
    end

    %% Final Output
    FactCheck -- "Verified" --> Deliverable([ðŸ“¦ Final Deliverable]):::mainNode
    UserAcceptance -- "Yes" --> ProdDeploy[ðŸš€ Production Deploy]:::mainNode
    ProdDeploy --> Deliverable

    %% Memory & Context
    GlobalMem[(ðŸ§  Global Context Memory)]:::storage
    LeadResearcher -.-> GlobalMem
    Architect -.-> GlobalMem
    CodeGenerator -.-> GlobalMem
    Synthesizer -.-> GlobalMem

    %% Links between squads
    Synthesizer -. "Feeds Requirements" .-> Architect
